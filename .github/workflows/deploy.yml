name: Deploy to public Pages repo

on:
  push:
    branches: ["main"]
    paths:
      - "index.html"
      - "viewer.html"
      - "assets/**"
      - "exercises/**"
      - "tools/build-manifest.js"
      - ".github/workflows/deploy.yml"

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source repo
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Build manifest.json
        run: node tools/build-manifest.js

      - name: Prepare publish folder
        run: |
          rm -rf public
          mkdir -p public
          cp index.html viewer.html manifest.json public/
          cp -r assets exercises public/

      - name: Deploy to public repo (gh-pages)
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          token: ${{ secrets.PAGES_DEPLOY_TOKEN }}
          repository-name: huy16dev/htmlcss
          branch: gh-pages
          folder: public
          clean: true
